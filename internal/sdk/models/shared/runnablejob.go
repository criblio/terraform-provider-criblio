// Code generated by Speakeasy (https://speakeasy.com). DO NOT EDIT.

package shared

import (
	"errors"
	"fmt"
	"github.com/criblio/terraform-provider-criblio/internal/sdk/internal/utils"
)

type RunnableJobType string

const (
	RunnableJobTypeRunnableJobCollection      RunnableJobType = "RunnableJobCollection"
	RunnableJobTypeRunnableJobExecutor        RunnableJobType = "RunnableJobExecutor"
	RunnableJobTypeRunnableJobScheduledSearch RunnableJobType = "RunnableJobScheduledSearch"
)

type RunnableJob struct {
	RunnableJobCollection      *RunnableJobCollection      `queryParam:"inline,name=RunnableJob"`
	RunnableJobExecutor        *RunnableJobExecutor        `queryParam:"inline,name=RunnableJob"`
	RunnableJobScheduledSearch *RunnableJobScheduledSearch `queryParam:"inline,name=RunnableJob"`

	Type RunnableJobType
}

func CreateRunnableJobRunnableJobCollection(runnableJobCollection RunnableJobCollection) RunnableJob {
	typ := RunnableJobTypeRunnableJobCollection

	return RunnableJob{
		RunnableJobCollection: &runnableJobCollection,
		Type:                  typ,
	}
}

func CreateRunnableJobRunnableJobExecutor(runnableJobExecutor RunnableJobExecutor) RunnableJob {
	typ := RunnableJobTypeRunnableJobExecutor

	return RunnableJob{
		RunnableJobExecutor: &runnableJobExecutor,
		Type:                typ,
	}
}

func CreateRunnableJobRunnableJobScheduledSearch(runnableJobScheduledSearch RunnableJobScheduledSearch) RunnableJob {
	typ := RunnableJobTypeRunnableJobScheduledSearch

	return RunnableJob{
		RunnableJobScheduledSearch: &runnableJobScheduledSearch,
		Type:                       typ,
	}
}

func (u *RunnableJob) UnmarshalJSON(data []byte) error {

	var candidates []utils.UnionCandidate

	// Collect all valid candidates
	var runnableJobCollection RunnableJobCollection = RunnableJobCollection{}
	if err := utils.UnmarshalJSON(data, &runnableJobCollection, "", true, nil); err == nil {
		candidates = append(candidates, utils.UnionCandidate{
			Type:  RunnableJobTypeRunnableJobCollection,
			Value: &runnableJobCollection,
		})
	}

	var runnableJobExecutor RunnableJobExecutor = RunnableJobExecutor{}
	if err := utils.UnmarshalJSON(data, &runnableJobExecutor, "", true, nil); err == nil {
		candidates = append(candidates, utils.UnionCandidate{
			Type:  RunnableJobTypeRunnableJobExecutor,
			Value: &runnableJobExecutor,
		})
	}

	var runnableJobScheduledSearch RunnableJobScheduledSearch = RunnableJobScheduledSearch{}
	if err := utils.UnmarshalJSON(data, &runnableJobScheduledSearch, "", true, nil); err == nil {
		candidates = append(candidates, utils.UnionCandidate{
			Type:  RunnableJobTypeRunnableJobScheduledSearch,
			Value: &runnableJobScheduledSearch,
		})
	}

	if len(candidates) == 0 {
		return fmt.Errorf("could not unmarshal `%s` into any supported union types for RunnableJob", string(data))
	}

	// Pick the best candidate using multi-stage filtering
	best := utils.PickBestCandidate(candidates)
	if best == nil {
		return fmt.Errorf("could not unmarshal `%s` into any supported union types for RunnableJob", string(data))
	}

	// Set the union type and value based on the best candidate
	u.Type = best.Type.(RunnableJobType)
	switch best.Type {
	case RunnableJobTypeRunnableJobCollection:
		u.RunnableJobCollection = best.Value.(*RunnableJobCollection)
		return nil
	case RunnableJobTypeRunnableJobExecutor:
		u.RunnableJobExecutor = best.Value.(*RunnableJobExecutor)
		return nil
	case RunnableJobTypeRunnableJobScheduledSearch:
		u.RunnableJobScheduledSearch = best.Value.(*RunnableJobScheduledSearch)
		return nil
	}

	return fmt.Errorf("could not unmarshal `%s` into any supported union types for RunnableJob", string(data))
}

func (u RunnableJob) MarshalJSON() ([]byte, error) {
	if u.RunnableJobCollection != nil {
		return utils.MarshalJSON(u.RunnableJobCollection, "", true)
	}

	if u.RunnableJobExecutor != nil {
		return utils.MarshalJSON(u.RunnableJobExecutor, "", true)
	}

	if u.RunnableJobScheduledSearch != nil {
		return utils.MarshalJSON(u.RunnableJobScheduledSearch, "", true)
	}

	return nil, errors.New("could not marshal union type RunnableJob: all fields are null")
}
