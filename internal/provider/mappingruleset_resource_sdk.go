// Code generated by Speakeasy (https://speakeasy.com). DO NOT EDIT.

package provider

import (
	"context"
	tfTypes "github.com/criblio/terraform-provider-criblio/internal/provider/types"
	"github.com/criblio/terraform-provider-criblio/internal/sdk/models/operations"
	"github.com/criblio/terraform-provider-criblio/internal/sdk/models/shared"
	"github.com/hashicorp/terraform-plugin-framework/diag"
	"github.com/hashicorp/terraform-plugin-framework/types"
)

func (r *MappingRulesetResourceModel) RefreshFromOperationsCreateAdminProductsMappingsByProductResponseBody(ctx context.Context, resp *operations.CreateAdminProductsMappingsByProductResponseBody) diag.Diagnostics {
	var diags diag.Diagnostics

	if resp != nil {
		if len(resp.Items) == 0 {
			diags.AddError("Unexpected response from API", "Missing response body array data.")
			return diags
		}

		diags.Append(r.RefreshFromSharedMappingRuleset(ctx, &resp.Items[0])...)

		if diags.HasError() {
			return diags
		}

	}

	return diags
}

func (r *MappingRulesetResourceModel) RefreshFromOperationsGetAdminProductsMappingsByProductAndIDResponseBody(ctx context.Context, resp *operations.GetAdminProductsMappingsByProductAndIDResponseBody) diag.Diagnostics {
	var diags diag.Diagnostics

	if resp != nil {
		if len(resp.Items) == 0 {
			diags.AddError("Unexpected response from API", "Missing response body array data.")
			return diags
		}

		diags.Append(r.RefreshFromSharedMappingRuleset(ctx, &resp.Items[0])...)

		if diags.HasError() {
			return diags
		}

	}

	return diags
}

func (r *MappingRulesetResourceModel) RefreshFromOperationsUpdateAdminProductsMappingsByProductAndIDResponseBody(ctx context.Context, resp *operations.UpdateAdminProductsMappingsByProductAndIDResponseBody) diag.Diagnostics {
	var diags diag.Diagnostics

	if resp != nil {
		if len(resp.Items) == 0 {
			diags.AddError("Unexpected response from API", "Missing response body array data.")
			return diags
		}

		diags.Append(r.RefreshFromSharedMappingRuleset(ctx, &resp.Items[0])...)

		if diags.HasError() {
			return diags
		}

	}

	return diags
}

func (r *MappingRulesetResourceModel) RefreshFromSharedMappingRuleset(ctx context.Context, resp *shared.MappingRuleset) diag.Diagnostics {
	var diags diag.Diagnostics

	r.Active = types.BoolPointerValue(resp.Active)
	if resp.Conf == nil {
		r.Conf = nil
	} else {
		r.Conf = &tfTypes.MappingRulesetConf{}
		r.Conf.Functions = []tfTypes.MappingRulesetFunctionConf{}

		for _, functionsItem := range resp.Conf.Functions {
			var functions tfTypes.MappingRulesetFunctionConf

			functions.Conf.Add = []tfTypes.MappingRulesetFunctionConfAdd{}

			for _, addItem := range functionsItem.Conf.Add {
				var add tfTypes.MappingRulesetFunctionConfAdd

				add.Name = types.StringValue(addItem.Name)
				add.Value = types.StringValue(addItem.Value)

				functions.Conf.Add = append(functions.Conf.Add, add)
			}
			functions.Description = types.StringPointerValue(functionsItem.Description)
			functions.Disabled = types.BoolPointerValue(functionsItem.Disabled)
			functions.Filter = types.StringPointerValue(functionsItem.Filter)
			functions.Final = types.BoolPointerValue(functionsItem.Final)
			functions.GroupID = types.StringPointerValue(functionsItem.GroupID)
			functions.ID = types.StringValue(functionsItem.ID)

			r.Conf.Functions = append(r.Conf.Functions, functions)
		}
	}
	r.ID = types.StringValue(resp.ID)

	return diags
}

func (r *MappingRulesetResourceModel) ToOperationsCreateAdminProductsMappingsByProductRequest(ctx context.Context) (*operations.CreateAdminProductsMappingsByProductRequest, diag.Diagnostics) {
	var diags diag.Diagnostics

	product := operations.CreateAdminProductsMappingsByProductProduct(r.Product.ValueString())
	var id string
	id = r.ID.ValueString()

	mappingRuleset, mappingRulesetDiags := r.ToSharedMappingRuleset(ctx)
	diags.Append(mappingRulesetDiags...)

	if diags.HasError() {
		return nil, diags
	}

	out := operations.CreateAdminProductsMappingsByProductRequest{
		Product:        product,
		ID:             id,
		MappingRuleset: *mappingRuleset,
	}

	return &out, diags
}

func (r *MappingRulesetResourceModel) ToOperationsDeleteAdminProductsMappingsByProductAndIDRequest(ctx context.Context) (*operations.DeleteAdminProductsMappingsByProductAndIDRequest, diag.Diagnostics) {
	var diags diag.Diagnostics

	product := operations.DeleteAdminProductsMappingsByProductAndIDProduct(r.Product.ValueString())
	var id string
	id = r.ID.ValueString()

	out := operations.DeleteAdminProductsMappingsByProductAndIDRequest{
		Product: product,
		ID:      id,
	}

	return &out, diags
}

func (r *MappingRulesetResourceModel) ToOperationsGetAdminProductsMappingsByProductAndIDRequest(ctx context.Context) (*operations.GetAdminProductsMappingsByProductAndIDRequest, diag.Diagnostics) {
	var diags diag.Diagnostics

	product := operations.GetAdminProductsMappingsByProductAndIDProduct(r.Product.ValueString())
	var id string
	id = r.ID.ValueString()

	out := operations.GetAdminProductsMappingsByProductAndIDRequest{
		Product: product,
		ID:      id,
	}

	return &out, diags
}

func (r *MappingRulesetResourceModel) ToOperationsUpdateAdminProductsMappingsByProductAndIDRequest(ctx context.Context) (*operations.UpdateAdminProductsMappingsByProductAndIDRequest, diag.Diagnostics) {
	var diags diag.Diagnostics

	product := operations.UpdateAdminProductsMappingsByProductAndIDProduct(r.Product.ValueString())
	var id string
	id = r.ID.ValueString()

	mappingRuleset, mappingRulesetDiags := r.ToSharedMappingRuleset(ctx)
	diags.Append(mappingRulesetDiags...)

	if diags.HasError() {
		return nil, diags
	}

	out := operations.UpdateAdminProductsMappingsByProductAndIDRequest{
		Product:        product,
		ID:             id,
		MappingRuleset: *mappingRuleset,
	}

	return &out, diags
}

func (r *MappingRulesetResourceModel) ToSharedMappingRuleset(ctx context.Context) (*shared.MappingRuleset, diag.Diagnostics) {
	var diags diag.Diagnostics

	var id string
	id = r.ID.ValueString()

	var conf *shared.MappingRulesetConf
	if r.Conf != nil {
		functions := make([]shared.MappingRulesetFunctionConf, 0, len(r.Conf.Functions))
		for functionsIndex := range r.Conf.Functions {
			filter := new(string)
			if !r.Conf.Functions[functionsIndex].Filter.IsUnknown() && !r.Conf.Functions[functionsIndex].Filter.IsNull() {
				*filter = r.Conf.Functions[functionsIndex].Filter.ValueString()
			} else {
				filter = nil
			}
			var id1 string
			id1 = r.Conf.Functions[functionsIndex].ID.ValueString()

			description := new(string)
			if !r.Conf.Functions[functionsIndex].Description.IsUnknown() && !r.Conf.Functions[functionsIndex].Description.IsNull() {
				*description = r.Conf.Functions[functionsIndex].Description.ValueString()
			} else {
				description = nil
			}
			disabled := new(bool)
			if !r.Conf.Functions[functionsIndex].Disabled.IsUnknown() && !r.Conf.Functions[functionsIndex].Disabled.IsNull() {
				*disabled = r.Conf.Functions[functionsIndex].Disabled.ValueBool()
			} else {
				disabled = nil
			}
			final := new(bool)
			if !r.Conf.Functions[functionsIndex].Final.IsUnknown() && !r.Conf.Functions[functionsIndex].Final.IsNull() {
				*final = r.Conf.Functions[functionsIndex].Final.ValueBool()
			} else {
				final = nil
			}
			add := make([]shared.MappingRulesetFunctionConfAdd, 0, len(r.Conf.Functions[functionsIndex].Conf.Add))
			for addIndex := range r.Conf.Functions[functionsIndex].Conf.Add {
				var name string
				name = r.Conf.Functions[functionsIndex].Conf.Add[addIndex].Name.ValueString()

				var value string
				value = r.Conf.Functions[functionsIndex].Conf.Add[addIndex].Value.ValueString()

				add = append(add, shared.MappingRulesetFunctionConfAdd{
					Name:  name,
					Value: value,
				})
			}
			conf1 := shared.MappingRulesetFunctionConfFunctionSpecificConfigs{
				Add: add,
			}
			groupID := new(string)
			if !r.Conf.Functions[functionsIndex].GroupID.IsUnknown() && !r.Conf.Functions[functionsIndex].GroupID.IsNull() {
				*groupID = r.Conf.Functions[functionsIndex].GroupID.ValueString()
			} else {
				groupID = nil
			}
			functions = append(functions, shared.MappingRulesetFunctionConf{
				Filter:      filter,
				ID:          id1,
				Description: description,
				Disabled:    disabled,
				Final:       final,
				Conf:        conf1,
				GroupID:     groupID,
			})
		}
		conf = &shared.MappingRulesetConf{
			Functions: functions,
		}
	}
	active := new(bool)
	if !r.Active.IsUnknown() && !r.Active.IsNull() {
		*active = r.Active.ValueBool()
	} else {
		active = nil
	}
	out := shared.MappingRuleset{
		ID:     id,
		Conf:   conf,
		Active: active,
	}

	return &out, diags
}
